services:
  osspid-client:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: osspid-client
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      # Server Configuration
      - NODE_ENV=production
      - SERVER_HOST=0.0.0.0
      - SERVER_PORT=3000
      - APP_URL=http://localhost:3000
      
      # Session Configuration
      - SESSION_SECRET=${SESSION_SECRET:-your-super-secret-key-change-in-production}
      - SESSION_SECURE=false
      
      # Keycloak Configuration
      - KEYCLOAK_HOST=${KEYCLOAK_HOST:-http://192.168.0.108:8880}
      - KEYCLOAK_REALM=${KEYCLOAK_REALM:-myrealm}
      - KEYCLOAK_CLIENT_ID=${KEYCLOAK_CLIENT_ID:-ss-client}
      - KEYCLOAK_CLIENT_SECRET=${KEYCLOAK_CLIENT_SECRET:-2QvtLNIDHLlvAMHsAMqwoba0AfF091Cu}
      - KEYCLOAK_IDP=${KEYCLOAK_IDP:-osspid}
      
      # OSSPID Direct Configuration
      - OSSPID_HOST=${OSSPID_HOST:-http://192.168.0.108:8050}
      - OSSPID_CLIENT_ID=${OSSPID_CLIENT_ID:-2520c78a5763a4ca5154224a38da6faf2cbfd4ec}
      - OSSPID_CLIENT_SECRET=${OSSPID_CLIENT_SECRET:-3e5ea9864ed71e05727a08611a1b1357b01f2f70}
      
      # UATID Configuration
      - UATID_HOST=${UATID_HOST:-https://idpv2.oss.net.bd}
      - UATID_REALM=${UATID_REALM:-osspid}
      - UATID_CLIENT_ID=${UATID_CLIENT_ID:-id-client-local}
      - UATID_CLIENT_SECRET=${UATID_CLIENT_SECRET:-cxYiKNaFMNS7gIjTiRYUipjYeE1fD5oJ}
      - UATID_IDP_HINT=${UATID_IDP_HINT:-uatid}
    volumes:
      # Mount logs directory (optional)
      - ./logs:/app/logs
    networks:
      - osspid-network
    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://localhost:3000/health', (r) => {process.exit(r.statusCode === 200 ? 0 : 1)})"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 10s

networks:
  osspid-network:
    driver: bridge
